apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: ibm-eventstreams-instance
  annotations:
    argocd.argoproj.io/sync-wave: "280"
  finalizers:
    - resources-finalizer.argocd.argoproj.io
  labels:
    gitops.tier.group: cloudpak
    gitops.tier.layer: services
    gitops.tier.source: git
spec:
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
  destination:
    namespace: dev
    server: https://kubernetes.default.svc
  project: services
  source:
    path: instances/ibm-eventstreams-instance
    helm:
      values: |
        ibm-eventstreams-instance:
          ibmeventstreamsinstance:
            name: light-insecure
            spec:
              version: latest
              license:
                # By installing this product you accept the license terms at https://ibm.biz/ea-license
                accept: true
                license: L-RJON-CJR2TC
                use: CloudPakForIntegrationNonProduction
              adminApi: {}
              adminUI: {}
              apicurioRegistry: {}
              collector: {}
              restProducer: {}
              security:
                internalTls: NONE
              strimziOverrides:
                kafka:
                  replicas: 1
                  config:
                    inter.broker.protocol.version: "3.5"
                    offsets.topic.replication.factor: 1
                    transaction.state.log.min.isr: 1
                    transaction.state.log.replication.factor: 1
                  listeners:
                    - name: plain
                      port: 9092
                      type: internal
                      tls: false
                  storage:
                    type: ephemeral
                  metricsConfig:
                    type: jmxPrometheusExporter
                    valueFrom:
                      configMapKeyRef:
                        key: kafka-metrics-config.yaml
                        name: light-insecure-metrics-config
                zookeeper:
                  replicas: 1
                  metricsConfig:
                    type: jmxPrometheusExporter
                    valueFrom:
                      configMapKeyRef:
                        key: zookeeper-metrics-config.yaml
                        name: light-insecure-metrics-config
                  storage:
                    type: ephemeral
              requestIbmServices:
                iam: false
                monitoring: false